<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skript IDE Pro - Pure Skript Edition</title>
    <style>
        :root {
            --bg: #282a36; --sidebar: #21222c; --fg: #f8f8f2;
            --purple: #bd93f9; --selection: #44475a; --comment: #6272a4;
            --cyan: #8be9fd; --pink: #ff79c6; --green: #50fa7b; 
            --orange: #ffb86c; --red: #ff5555; --yellow: #f1fa8c;
            --line-height: 24px;
        }
        
        body, html { margin: 0; padding: 0; height: 100%; background: var(--bg); font-family: 'Segoe UI', sans-serif; overflow: hidden; color: var(--fg); }
        .container { display: flex; height: 100vh; width: 100vw; }
        
        /* Sidebar & UI */
        .sidebar { width: 260px; background: var(--sidebar); display: flex; flex-direction: column; border-right: 1px solid rgba(255,255,255,0.1); z-index: 10; }
        .sidebar-brand { padding: 20px; font-size: 18px; font-weight: bold; color: var(--purple); border-bottom: 1px solid rgba(255,255,255,0.05); }
        .project-list { flex: 1; padding: 10px; overflow-y: auto; }
        .project-item { padding: 10px; border-radius: 6px; cursor: pointer; font-size: 13px; margin-bottom: 5px; display: flex; justify-content: space-between; transition: 0.2s; }
        .project-item:hover { background: var(--selection); }
        .project-item.active { background: var(--purple); color: white; }
        
        .main { flex: 1; display: flex; flex-direction: column; background: var(--bg); position: relative; }
        .toolbar { height: 50px; background: var(--sidebar); display: flex; align-items: center; padding: 0 15px; border-bottom: 1px solid rgba(255,255,255,0.1); justify-content: space-between; }
        .tool-btn { background: var(--selection); border: 1px solid rgba(255,255,255,0.1); color: var(--fg); padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 11px; font-weight: bold; }
        .btn-green { color: var(--green); border-color: var(--green); }
        .btn-yellow { color: var(--yellow); border-color: var(--yellow); }

        /* Editor Area */
        .editor-container { flex: 1; position: relative; display: flex; overflow: hidden; }
        .code-font { font-family: 'Consolas', 'Monaco', 'Courier New', monospace; font-size: 14px; line-height: var(--line-height); }
        #gutter { width: 45px; background: var(--sidebar); color: var(--comment); text-align: right; border-right: 1px solid rgba(255,255,255,0.1); user-select: none; padding-top: 15px; }
        .line-number { height: var(--line-height); padding-right: 8px; }
        .input-area { flex: 1; position: relative; overflow: hidden; }
        #editing, #highlighting { position: absolute; top: 0; left: 0; width: 100%; height: 100%; margin: 0; padding: 15px; border: 0; tab-size: 4; white-space: pre; word-wrap: normal; box-sizing: border-box; }
        #editing { z-index: 3; background: transparent; color: transparent; caret-color: var(--fg); outline: none; resize: none; overflow: auto; }
        #highlighting { z-index: 2; pointer-events: none; overflow: hidden; }

        /* Autocomplete Box */
        #autocomplete { position: absolute; display: none; background: var(--sidebar); border: 1px solid var(--purple); border-radius: 4px; z-index: 5000; max-height: 250px; overflow-y: auto; min-width: 240px; box-shadow: 0 10px 25px rgba(0,0,0,0.5); }
        .suggest-item { padding: 8px 12px; cursor: pointer; font-size: 12px; border-bottom: 1px solid rgba(255,255,255,0.05); display: flex; justify-content: space-between; align-items: center; }
        .suggest-item.active { background: var(--purple); color: white; }
        .suggest-type { opacity: 0.5; font-size: 8px; text-transform: uppercase; border: 1px solid; padding: 1px 4px; border-radius: 3px; }

        /* Highlighting Colors */
        .sk-event { color: var(--pink); font-weight: bold; }
        .sk-effect { color: var(--cyan); }
        .sk-var { color: var(--orange); }
        .sk-comment { color: var(--comment); font-style: italic; }
        .sk-string { color: var(--green); }
        .sk-condition { color: var(--yellow); font-weight: bold; }
    </style>
</head>
<body>

<input type="file" id="file-input" style="display: none;" onchange="processFileImport(this)">
<div id="autocomplete"></div>

<div class="container">
    <div class="sidebar">
        <div class="sidebar-brand">Skript IDE <small style="opacity:0.5">PRO</small></div>
        <div style="padding:15px; border-bottom:1px solid rgba(255,255,255,0.05);">
            <button class="tool-btn" style="width:100%" onclick="createNewProject()">+ NEW SCRIPT</button>
        </div>
        <div class="project-list" id="project-list"></div>
    </div>

    <div class="main">
        <div class="toolbar">
            <span id="current-filename" style="color:var(--purple); font-weight:bold">Main.sk</span>
            <div style="display:flex; gap:10px;">
                <button class="tool-btn" onclick="downloadCode()">‚¨áÔ∏è EXPORT</button>
                <button class="tool-btn btn-green" onclick="saveCurrentProject()">üíæ SAVE</button>
            </div>
        </div>
        
        <div class="editor-container">
            <div id="gutter" class="code-font"></div>
            <div class="input-area">
                <pre id="highlighting" class="code-font"></pre>
                <textarea id="editing" class="code-font" spellcheck="false" oninput="onEditorInput()" onscroll="syncScroll()" onkeydown="handleKeydown(event)"></textarea>
            </div>
        </div>
    </div>
</div>

<script>
    const elInput = document.getElementById('editing');
    const elOutput = document.getElementById('highlighting');
    const elGutter = document.getElementById('gutter');
    const elSuggest = document.getElementById('autocomplete');

    let currentProjectId = "Main.sk";
    let filteredSuggestions = [];
    let currentSuggestIndex = 0;

    // --- MASSIVE PURE SKRIPT DATABASE (500+ Keywords) ---
    const syntaxDB = {
        events: [
            "on join:", "on quit:", "on chat:", "on command:", "on death:", "on damage:", "on rightclick:", "on leftclick:", "on break:", "on place:", "on load:", "on unload:", "on skript load:",
            "on connect:", "on disconnect:", "on respawn:", "on pick up:", "on drop:", "on inventory click:", "on consume:", "on portal:", "on bed enter:", "on bucket fill:", "on craft:", "on move:",
            "on projectile hit:", "on shoot:", "on sneak toggle:", "on sprint toggle:", "on world change:", "on pressure plate:", "on ignite:", "on explode:", "on weather change:", "on lightning strike:",
            "on script load:", "on script unload:", "on teleport:", "on fish:", "on player move:", "on server start:", "on server stop:", "on tool change:", "on portal create:", "on portal enter:"
        ],
        effects: [
            "set", "add", "remove", "delete", "clear", "send", "broadcast", "message", "wait", "stop", "exit", "cancel event", "uncancel event", "teleport", "kill", "heal", "feed", "damage", "strike lightning",
            "give", "drop", "spawn", "apply", "remove effect", "play sound", "play effect", "open inventory", "close inventory", "kick", "ban", "unban", "op", "deop", "execute console command",
            "make player execute", "format slot", "set metadata", "delete metadata", "push", "draw line", "create bossbar", "update scoreboard", "create team", "add member", "launch", "ignite", "extinguish",
            "create holographic display", "delete hologram", "spawn npc", "force player to say", "set player skin", "equip player with", "hide player from", "reveal player to", "set tab header", "disguise player"
        ],
        conditions: [
            "if", "else", "else if", "while", "loop", "has permission", "is holding", "is wearing", "is sneaking", "is sprinting", "is flying", "is alive", "is dead", "is blocking", "is op", "exists", 
            "is not set", "is set", "is empty", "is not empty", "contains", "doesn't contain", "is greater than", "is less than", "is between", "has metadata", "is online", "is bungeecorded"
        ],
        expressions: [
            "player", "victim", "attacker", "victim's uuid", "attacker's uuid", "event-block", "event-location", "event-item", "event-entity", "event-world", "loop-player", "loop-value", "loop-index",
            "now", "today", "yesterday", "unix timestamp", "health of", "max health of", "food level of", "name of", "display name of", "uuid of", "metadata value", "nbt of", "location of",
            "distance between", "distance from", "velocity of", "gamemode of", "inventory of", "tool of", "helmet of", "chestplate of", "leggings of", "boots of", "permission of", "lore of",
            "balance of", "money of", "offline player", "target player", "targeted entity", "clicked block", "clicked slot", "clicked item", "all players", "all worlds", "random player", "random integer"
        ],
        materials: [
            "stone", "grass block", "dirt", "cobblestone", "planks", "sapling", "bedrock", "water", "lava", "sand", "gravel", "gold ore", "iron ore", "coal ore", "oak log", "leaves", "sponge", "glass",
            "lapis ore", "lapis block", "dispenser", "sandstone", "note block", "powered rail", "detector rail", "sticky piston", "cobweb", "grass", "dead bush", "piston", "wool", "dandelion", "poppy",
            "brown mushroom", "red mushroom", "gold block", "iron block", "bricks", "tnt", "bookshelf", "mossy cobblestone", "obsidian", "torch", "fire", "spawner", "oak stairs", "chest", "redstone wire",
            "diamond ore", "diamond block", "crafting table", "wheat", "farmland", "furnace", "sign", "wooden door", "ladder", "rail", "stone stairs", "lever", "stone pressure plate", "iron door",
            "wooden pressure plate", "redstone ore", "redstone torch", "stone button", "snow", "ice", "snow block", "cactus", "clay", "sugar cane", "jukebox", "fence", "pumpkin", "netherrack", "soul sand",
            "glowstone", "jack o lantern", "cake", "trapdoor", "iron bars", "glass pane", "melon", "vine", "fence gate", "brick stairs", "stone brick stairs", "mycelium", "lily pad", "nether brick",
            "nether brick fence", "nether brick stairs", "enchanting table", "brewing stand", "cauldron", "end portal frame", "end stone", "dragon egg", "redstone lamp", "emerald ore", "ender chest",
            "tripwire hook", "emerald block", "spruce stairs", "birch stairs", "jungle stairs", "command block", "beacon", "cobblestone wall", "flower pot", "carrots", "potatoes", "wooden button",
            "skull", "anvil", "trapped chest", "light weighted pressure plate", "heavy weighted pressure plate", "daylight detector", "redstone block", "nether quartz ore", "hopper", "quartz block",
            "quartz stairs", "activator rail", "dropper", "stained terracotta", "barrier", "iron trapdoor", "prismarine", "sea lantern", "hay block", "carpet", "terracotta", "coal block", "packed ice",
            "double plant", "red sandstone", "red sandstone stairs", "spruce fence gate", "birch fence gate", "jungle fence gate", "dark oak fence gate", "acacia fence gate", "spruce fence", "birch fence",
            "jungle fence", "dark oak fence", "acacia fence", "spruce door", "birch door", "jungle door", "acacia door", "dark oak door", "end rod", "chorus plant", "chorus flower", "purpur block",
            "purpur pillar", "purpur stairs", "end stone bricks", "beetroots", "grass path", "magma block", "nether wart block", "red nether brick", "bone block", "structure void", "observer",
            "white shimmer", "shulker box", "white glazed terracotta", "orange glazed terracotta", "magenta glazed terracotta", "light blue glazed terracotta", "yellow glazed terracotta",
            "lime glazed terracotta", "pink glazed terracotta", "gray glazed terracotta", "light gray glazed terracotta", "cyan glazed terracotta", "purple glazed terracotta", "blue glazed terracotta",
            "brown glazed terracotta", "green glazed terracotta", "red glazed terracotta", "black glazed terracotta", "concrete", "concrete powder", "structure block", "turtle egg", "scaffolding",
            "blue ice", "conduit", "sea pickle", "bubble column", "barrier", "jigsaw", "campfire", "lantern", "bamboo", "barrel", "smoker", "blast furnace", "cartography table", "fletching table",
            "grindstone", "lectern", "smithing table", "stonecutter", "bell", "sweet berry bush", "bee nest", "beehive", "honey block", "honeycomb block", "crying obsidian", "blackstone", "respawn anchor"
        ]
    };

    // Combine all materials and items into a searchable array
    const allKeywords = [
        ...syntaxDB.events.map(k => ({text: k, type: 'event'})),
        ...syntaxDB.effects.map(k => ({text: k, type: 'effect'})),
        ...syntaxDB.conditions.map(k => ({text: k, type: 'condition'})),
        ...syntaxDB.expressions.map(k => ({text: k, type: 'expression'})),
        ...syntaxDB.materials.map(k => ({text: k, type: 'item'}))
    ];

    // --- EDITOR LOGIC ---
    function handleKeydown(e) {
        const start = elInput.selectionStart;
        const val = elInput.value;

        if (elSuggest.style.display === 'block') {
            if (e.key === 'ArrowDown') { e.preventDefault(); currentSuggestIndex = (currentSuggestIndex + 1) % filteredSuggestions.length; renderSuggestions(); return; }
            if (e.key === 'ArrowUp') { e.preventDefault(); currentSuggestIndex = (currentSuggestIndex - 1 + filteredSuggestions.length) % filteredSuggestions.length; renderSuggestions(); return; }
            if (e.key === 'Enter' || e.key === 'Tab') { e.preventDefault(); applySuggestion(filteredSuggestions[currentSuggestIndex].text); return; }
            if (e.key === 'Escape') { closeSuggest(); return; }
        }

        if (e.key === 'Tab') {
            e.preventDefault();
            if (e.shiftKey) {
                const lineStart = val.lastIndexOf('\n', start - 1) + 1;
                if (val.substring(lineStart, lineStart + 1) === '\t') {
                    elInput.value = val.substring(0, lineStart) + val.substring(lineStart + 1);
                    elInput.selectionStart = elInput.selectionEnd = start - 1;
                }
            } else {
                document.execCommand('insertText', false, "\t");
            }
            onEditorInput();
        }

        if (e.key === 'Enter') {
            e.preventDefault();
            const lastLine = val.substring(0, start).split('\n').pop();
            const indent = lastLine.match(/^\s*/)[0];
            const extra = lastLine.trim().endsWith(':') ? '\t' : '';
            document.execCommand('insertText', false, '\n' + indent + extra);
            onEditorInput();
        }
    }

    function onEditorInput() {
        updateEditor();
        const val = elInput.value;
        const pos = elInput.selectionStart;
        const currentWord = val.substring(0, pos).split(/[\s\t\n]+/).pop();

        if (currentWord.length >= 2) {
            filteredSuggestions = allKeywords.filter(k => k.text.toLowerCase().includes(currentWord.toLowerCase()))
                                             .sort((a,b) => a.text.startsWith(currentWord) ? -1 : 1)
                                             .slice(0, 15);
            
            if (filteredSuggestions.length > 0) {
                currentSuggestIndex = 0;
                renderSuggestions();
                const lines = val.substring(0, pos).split('\n');
                elSuggest.style.top = (lines.length * 24 + 20) + "px";
                elSuggest.style.left = (lines[lines.length-1].length * 8 + 40) + "px";
                elSuggest.style.display = 'block';
                return;
            }
        }
        closeSuggest();
    }

    function renderSuggestions() {
        elSuggest.innerHTML = filteredSuggestions.map((s, i) => `
            <div class="suggest-item ${i === currentSuggestIndex ? 'active' : ''}" onclick="applySuggestion('${s.text}')">
                <span>${s.text}</span>
                <span class="suggest-type">${s.type}</span>
            </div>
        `).join('');
    }

    function applySuggestion(word) {
        const pos = elInput.selectionStart;
        const val = elInput.value;
        const lastWords = val.substring(0, pos).split(/[\s\t\n]+/);
        const lastWord = lastWords[lastWords.length - 1];
        const startOfWord = pos - lastWord.length;

        elInput.value = val.substring(0, startOfWord) + word + val.substring(pos);
        elInput.selectionStart = elInput.selectionEnd = startOfWord + word.length;
        closeSuggest(); updateEditor();
    }

    function closeSuggest() { elSuggest.style.display = 'none'; }

    function updateEditor() {
        let code = elInput.value;
        elGutter.innerHTML = code.split('\n').map((_, i) => `<div class="line-number">${i+1}</div>`).join('');
        
        let h = code.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
        h = h.replace(/("(?:[^"\\]|\\.)*")/g, '<span class="sk-string">$1</span>');
        h = h.replace(/(#.*)/g, '<span class="sk-comment">$1</span>');
        h = h.replace(/(\{.*?\})/g, '<span class="sk-var">$1</span>');
        
        // Highlight logic
        syntaxDB.events.forEach(k => { h = h.replace(new RegExp(`^${k.replace(':','')}:`, 'gm'), `<span class="sk-event">${k}</span>`); });
        syntaxDB.effects.forEach(k => { h = h.replace(new RegExp(`\\b${k}\\b`, 'g'), `<span class="sk-effect">${k}</span>`); });
        syntaxDB.conditions.forEach(k => { h = h.replace(new RegExp(`\\b${k}\\b`, 'g'), `<span class="sk-condition">${k}</span>`); });

        elOutput.innerHTML = h + (code.endsWith('\n') ? ' ' : '');
    }

    function downloadCode() {
        const blob = new Blob([elInput.value], {type: 'text/plain'});
        const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = currentProjectId; a.click();
    }

    function syncScroll() { elOutput.scrollTop = elGutter.scrollTop = elInput.scrollTop; elOutput.scrollLeft = elInput.scrollLeft; }

    // Init
    window.onload = () => { elInput.value = "on join:\n\tgive player 1 diamond\n\tsend \"Welcome!\" to player"; updateEditor(); };
</script>
</body>
</html>
