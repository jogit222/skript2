<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skript IDE Pro - Integrated</title>
    <style>
        :root {
            --bg: #282a36; --sidebar: #21222c; --fg: #f8f8f2;
            --purple: #bd93f9; --selection: #44475a; --comment: #6272a4;
            --cyan: #8be9fd; --pink: #ff79c6; --green: #50fa7b; --orange: #ffb86c; --red: #ff5555;
        }
        
        body.theme-monokai { --bg: #272822; --sidebar: #1e1f1c; --fg: #f8f8f2; --purple: #ae81ff; --selection: #49483e; --cyan: #66d9ef; --pink: #f92672; --green: #a6e22e; }
        body.theme-light { --bg: #ffffff; --sidebar: #f0f0f0; --fg: #2e3440; --purple: #5e81ac; --selection: #d8dee9; --comment: #9ea3af; --cyan: #88c0d0; --pink: #bf616a; --green: #a3be8c; }

        body, html { margin: 0; padding: 0; height: 100%; background: var(--bg); font-family: 'Segoe UI', sans-serif; overflow: hidden; color: var(--fg); transition: background 0.3s; }
        .container { display: flex; height: 100vh; width: 100vw; }
        
        .sidebar { width: 240px; background: var(--sidebar); display: flex; flex-direction: column; border-right: 1px solid rgba(255,255,255,0.1); z-index: 10; }
        .sidebar-brand { padding: 20px; font-size: 18px; font-weight: bold; color: var(--purple); border-bottom: 1px solid rgba(255,255,255,0.05); }
        
        .main { flex: 1; display: flex; flex-direction: column; background: var(--bg); position: relative; }
        .toolbar { height: 50px; background: var(--sidebar); display: flex; align-items: center; padding: 0 15px; border-bottom: 1px solid rgba(255,255,255,0.1); justify-content: space-between; }
        .tool-btn { background: var(--selection); border: 1px solid rgba(255,255,255,0.1); color: var(--fg); padding: 8px 14px; border-radius: 4px; cursor: pointer; font-size: 11px; font-weight: bold; transition: 0.2s; display: flex; align-items: center; gap: 6px; }

        .editor-container { flex: 1; position: relative; display: flex; overflow: hidden; background: var(--bg); }
        
        #gutter { 
            width: 50px; 
            background: var(--sidebar); 
            color: var(--comment); 
            padding: 15px 5px; 
            text-align: right; 
            font-family: 'Consolas', 'Monaco', monospace; 
            border-right: 1px solid rgba(255,255,255,0.1); 
            user-select: none;
            z-index: 5;
            flex-shrink: 0;
            overflow: hidden;
        }

        .input-area { flex: 1; position: relative; overflow: hidden; }

        #editing, #highlighting { 
            position: absolute; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            margin: 0; 
            padding: 15px; 
            border: 0; 
            font-family: 'Consolas', 'Monaco', monospace; 
            line-height: 1.6; 
            tab-size: 4; 
            white-space: pre; 
            box-sizing: border-box; 
            overflow: auto;
        }

        #editing { z-index: 3; background: transparent; color: transparent; caret-color: var(--fg); outline: none; resize: none; }
        #highlighting { z-index: 2; pointer-events: none; }

        #modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; }
        #modal { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--sidebar); padding: 30px; border-radius: 12px; width: 400px; border: 1px solid var(--purple); }
        .input-field { width: 100%; background: var(--bg); border: 1px solid rgba(255,255,255,0.1); color: var(--fg); padding: 12px; border-radius: 6px; margin-bottom: 20px; box-sizing: border-box;}

        /* Syntax Colors */
        .sk-event { color: var(--pink); font-weight: bold; }
        .sk-effect { color: var(--cyan); }
        .sk-var { color: var(--orange); }
        .sk-comment { color: var(--comment); font-style: italic; }
        .sk-string { color: var(--green); }
        .sk-bracket { color: var(--purple); font-weight: bold; }
    </style>
</head>
<body>

<div id="modal-overlay">
    <div id="modal">
        <h2 style="margin-top:0; color:var(--purple)">Editor Config</h2>
        <label style="font-size: 11px; color: var(--purple); font-weight: bold;">THEME</label>
        <select id="theme-select" class="input-field" onchange="changeTheme()">
            <option value="dracula">Dracula</option>
            <option value="monokai">Monokai</option>
            <option value="light">Light</option>
        </select>
        <label style="font-size: 11px; color: var(--purple); font-weight: bold;">FONT SIZE</label>
        <input type="number" id="font-size" class="input-field" value="14" onchange="changeFontSize()">
        <button class="tool-btn" style="width:100%; padding:15px; background:var(--purple); border:none; color:white;" onclick="closeSettings()">CLOSE</button>
    </div>
</div>

<div class="container">
    <div class="sidebar">
        <div class="sidebar-brand">Skript IDE Pro</div>
        <div style="flex: 1; padding: 20px;">
            <div style="background: var(--selection); padding: 10px; border-radius: 6px; font-size: 13px;">üìÑ main.sk</div>
            <div style="margin-top:20px; font-size: 10px; color: var(--comment); text-transform: uppercase; letter-spacing: 1px;">Shortcuts</div>
            <p style="font-size: 11px; color: var(--fg); opacity: 0.7;">Tab: Autocomplete<br>Brackets: Auto-pair</p>
        </div>
        <div style="padding: 20px; border-top: 1px solid rgba(255,255,255,0.05); display:flex; flex-direction:column; gap:10px;">
            <button class="tool-btn" onclick="copyToClipboard()">üìã COPY CODE</button>
            <button class="tool-btn" style="color:var(--red)" onclick="clearEditor()">üóëÔ∏è CLEAR ALL</button>
        </div>
    </div>

    <div class="main">
        <div class="toolbar">
            <span style="color: var(--purple); font-weight: bold;">main.sk <small id="save-status" style="font-weight:normal; color:var(--comment); opacity:0.6; margin-left:10px;">(Synced)</small></span>
            <button class="tool-btn" onclick="openSettings()">‚öôÔ∏è SETTINGS</button>
        </div>
        <div class="editor-container">
            <div id="gutter">1</div>
            <div class="input-area">
                <pre id="highlighting"></pre>
                <textarea id="editing" spellcheck="false" oninput="handleInput()" onscroll="syncScroll()"></textarea>
            </div>
        </div>
    </div>
</div>

<script>
    const elInput = document.getElementById('editing');
    const elOutput = document.getElementById('highlighting');
    const elGutter = document.getElementById('gutter');

    // Autocomplete list including Addons
    const dictionary = [
        "on join:", "on quit:", "on break:", "on place:", "on death:", "on damage:", "on chat:", "on command:",
        "command", "trigger:", "permission:", "executable by:", "arguments:", "description:", "usage:",
        "send", "broadcast", "set", "add", "remove", "give", "cancel event", "stop", "wait", "loop", "if", "else", 
        "open virtual chest", "format slot", "create a gui", "display hologram", "metadata tag", "mysql query", "player"
    ];

    let state = JSON.parse(localStorage.getItem('sk_ide_v2')) || {
        theme: 'dracula',
        fontSize: 14,
        code: "on join:\n\tsend \"Welcome to the server!\"\n\tset {player.joined} to true"
    };

    function init() {
        elInput.value = state.code;
        document.getElementById('theme-select').value = state.theme;
        document.getElementById('font-size').value = state.fontSize;
        changeTheme();
        changeFontSize();
        updateEditor();
    }

    // Advanced Keyboard Handling (Autocomplete + Brackets)
    elInput.addEventListener('keydown', function(e) {
        const start = this.selectionStart;
        const end = this.selectionEnd;
        const val = this.value;

        // 1. Bracket/Quote Matching
        const pairs = { '(': ')', '[': ']', '{': '}', '"': '"', "'": "'" };
        if (pairs[e.key]) {
            e.preventDefault();
            this.value = val.substring(0, start) + e.key + pairs[e.key] + val.substring(end);
            this.selectionStart = this.selectionEnd = start + 1;
            handleInput();
        }

        // 2. Tab Autocomplete Logic
        if (e.key === 'Tab') {
            const beforeCursor = val.substring(0, start);
            const words = beforeCursor.split(/[\s\n\t]+/);
            const lastWord = words[words.length - 1];

            if (lastWord.length > 1) {
                const match = dictionary.find(w => w.startsWith(lastWord.toLowerCase()));
                if (match) {
                    e.preventDefault();
                    const wordStart = start - lastWord.length;
                    this.value = val.substring(0, wordStart) + match + val.substring(end);
                    this.selectionStart = this.selectionEnd = wordStart + match.length;
                    handleInput();
                }
            } else {
                // Regular tab behavior if no word
                e.preventDefault();
                this.value = val.substring(0, start) + "\t" + val.substring(end);
                this.selectionStart = this.selectionEnd = start + 1;
                handleInput();
            }
        }
    });

    function handleInput() {
        state.code = elInput.value;
        updateEditor();
        localStorage.setItem('sk_ide_v2', JSON.stringify(state));
    }

    function updateEditor() {
        let code = elInput.value;

        // Update Gutter
        const lineCount = code.split('\n').length;
        elGutter.innerHTML = Array.from({length: lineCount}, (_, i) => i + 1).join('<br>');

        // Highlight Logic
        let h = code.replace(/&/g, "&amp;").replace(/</g, "&lt;");
        
        // Brackets
        h = h.replace(/[\(\)\[\]\{\}]/g, '<span class="sk-bracket">$&</span>');
        
        // Strings
        h = h.replace(/"([^"]*)"/g, `<span class="sk-string">"$1"</span>`);
        
        // Events (Lines ending in colon)
        h = h.replace(/^(on\s+.*:)/gm, '<span class="sk-event">$1</span>');
        
        // Effects & Control Flow
        const effects = /\b(send|broadcast|give|set|add|remove|cancel event|stop|wait|if|else|loop|command|trigger|permission|arguments|usage)\b/g;
        h = h.replace(effects, '<span class="sk-effect">$1</span>');
        
        // Variables
        h = h.replace(/\{([\w\.\%]+)\}/g, '<span class="sk-var">{$1}</span>');
        
        // Comments
        h = h.replace(/#.*/g, '<span class="sk-comment">$&</span>');

        elOutput.innerHTML = h + (code.endsWith('\n') ? ' ' : '');
    }

    function syncScroll() { 
        elOutput.scrollTop = elInput.scrollTop; 
        elOutput.scrollLeft = elInput.scrollLeft; 
        elGutter.scrollTop = elInput.scrollTop; 
    }

    function changeTheme() {
        state.theme = document.getElementById('theme-select').value;
        document.body.className = state.theme === 'dracula' ? '' : 'theme-' + state.theme;
        localStorage.setItem('sk_ide_v2', JSON.stringify(state));
    }

    function changeFontSize() {
        state.fontSize = document.getElementById('font-size').value;
        const size = state.fontSize + 'px';
        elInput.style.fontSize = size;
        elOutput.style.fontSize = size;
        elGutter.style.fontSize = size;
        localStorage.setItem('sk_ide_v2', JSON.stringify(state));
    }

    function copyToClipboard() {
        navigator.clipboard.writeText(elInput.value);
        alert("Code copied!");
    }

    function clearEditor() {
        if(confirm("Delete everything?")) {
            elInput.value = "";
            handleInput();
        }
    }

    function openSettings() { document.getElementById('modal-overlay').style.display = 'block'; }
    function closeSettings() { document.getElementById('modal-overlay').style.display = 'none'; }

    init();
</script>
</body>
</html>
